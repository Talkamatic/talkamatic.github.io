


<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="shortcut icon" href="assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-5.2.2">
    
    
      
        <title>Step-by-step tutorial - TDM</title>
      
    
    
      <link rel="stylesheet" href="assets/stylesheets/main.a2408e81.min.css">
      
      
    
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style>
      
    
    
    
    
      
    
    
  </head>
  
  
    <body dir="ltr">
  
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#step-1-create-the-boilerplate" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid" aria-label="Header">
    <a href="." title="TDM" class="md-header-nav__button md-logo" aria-label="TDM">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header-nav__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header-nav__title" data-md-component="header-title">
      
        <div class="md-header-nav__ellipsis">
          <span class="md-header-nav__topic md-ellipsis">
            TDM
          </span>
          <span class="md-header-nav__topic md-ellipsis">
            
              Step-by-step tutorial
            
          </span>
        </div>
      
    </div>
    
      <label class="md-header-nav__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active">
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" data-md-component="search-reset" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
        
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="." title="TDM" class="md-nav__button md-logo" aria-label="TDM">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    TDM
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="index.html" title="Introduction" class="md-nav__link">
      Introduction
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="formalism.html" title="Dialog Formalism" class="md-nav__link">
      Dialog Formalism
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
    <a href="tutorial.html" title="Step-by-step tutorial" class="md-nav__link md-nav__link--active">
      Step-by-step tutorial
    </a>
    
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="examples.html" title="Examples" class="md-nav__link">
      Examples
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="rasa_nlu.html" title="Using Rasa NLU" class="md-nav__link">
      Using Rasa NLU
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6">
    
    <label class="md-nav__link" for="nav-6">
      APIs
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="APIs" data-md-level="1">
      <label class="md-nav__title" for="nav-6">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        APIs
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="APIs/http_frontend.html" title="API for HTTP frontends" class="md-nav__link">
      API for HTTP frontends
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="APIs/http_service.html" title="API for HTTP services" class="md-nav__link">
      API for HTTP services
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                  
                
                
                <h1 id="step-1-create-the-boilerplate">Step 1. Create the boilerplate</h1>
<p>First we need to create the DDD boilerplate.</p>
<pre><code class="bash">mkdir ddd_root; cd ddd_root 
tdm create-ddd basic_action
</code></pre>

<p>Before your DDD can be used, it needs to be built.</p>
<pre><code class="bash">tdm build
</code></pre>

<p>To make sure your DDD and all dependencies are working as intended, let's run interaction tests.</p>
<pre><code class="bash">tdm test eng
</code></pre>

<pre><code class="bash">Ran 1 test in 0.386s

OK
</code></pre>

<p>The test reports OK. We're ready to start adding dialogue to our DDD. </p>
<h1 id="step-2-interaction-test">Step 2. Interaction test</h1>
<p>Since we're working test driven, let's add an interaction test first.</p>
<p>Interaction tests verifiy the dialogue, providing user utterances and specifying the expected system responses.</p>
<p>Modify <code>basic_action/test/interaction_tests_eng.txt</code>, add a test for the new dialogue that we want to support. We proceed one step at a time, starting with a very simple dialogue.</p>
<pre><code class="diff">--- call
S&gt; What would you like to do?
U&gt; call
S&gt; Who do you want to call?
</code></pre>

<p>Let's run the tests again to verify that they fail. (We don't need to rebuild after only modifying tests.)</p>
<pre><code class="bash">tdm test eng
</code></pre>

<p>TDM will complain that it does not understand instead the user.</p>
<pre><code class="diff">On line 7 of basic_action/test/interaction_tests_eng.txt,
expected:
  S&gt; Who do you want to call?

but got:
  S&gt; I heard you say call. I don't understand. So, What would you like to do?
</code></pre>

<p>This happens because there's no notion of calling in the DDD.</p>
<h1 id="step-3-ontology">Step 3. Ontology</h1>
<p>The ontology declares what users can do and talk about, much like header files. In order to call someone we need to add the notion of calling, and the notion of people, to the ontology.</p>
<p>Our boilerplate ontology is basically empty, in <code>basic_action/ontology.xml</code>.</p>
<pre><code class="xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;
&lt;ontology name=&quot;BasicActionOntology&quot;&gt;
&lt;/ontology&gt;
</code></pre>

<p>We extend it with an action to make calls:</p>
<pre><code class="xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;
&lt;ontology name=&quot;BasicActionOntology&quot;&gt;
  &lt;action name=&quot;call&quot;/&gt;
&lt;/ontology&gt;
</code></pre>

<p>Let's build and run the tests again to see if we missed something.</p>
<pre><code class="bash">tdm build
</code></pre>

<p>We now receive a warning.</p>
<pre><code class="diff">Generating models for DDD 'basic_action'.
[eng] Cleaning build directory 'build/eng'...Done.
[eng] Generating grammar.

Missing grammar entry: How do speakers talk about the action 'call'? Possible contents of the &lt;action&gt; element:

  &lt;verb-phrase&gt;
  &lt;noun-phrase&gt;
  &lt;one-of&gt;
[eng] Finished generating grammar.
Finished generating models for DDD 'basic_action'.
Training models for DDD 'basic_action'.
[eng] Asserting that language grammar is lower case...Done.
[eng] Compiling generated grammar.
[eng] Finished compiling generated grammar.
[eng] No ASR specified, will not build language model.
[eng] Copying ASR language modules from '/private/tmp/ddd_root/basic_action/grammar/build/eng' to ddd directory...Done.
[eng] Not using word list correction, will not generate word list.
</code></pre>

<p>Apparently, ontology entries require their corresponding grammar entries.</p>
<h1 id="step-4-grammar">Step 4. Grammar</h1>
<p>The grammar defines what our users and system can say. Our previous build attempt told us to add an entry for the <code>call</code> action. Let's extend <code>basic_action/grammar/grammar_eng.xml</code> with the <code>call</code> action.</p>
<pre><code class="xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;
&lt;grammar&gt;
  &lt;action name=&quot;call&quot;&gt;
    &lt;verb-phrase&gt;
      &lt;verb ref=&quot;call&quot;/&gt;
    &lt;/verb-phrase&gt;
  &lt;/action&gt;

  &lt;lexicon&gt;
    &lt;verb id=&quot;call&quot;&gt;
      &lt;infinitive&gt;call&lt;/infinitive&gt;
    &lt;/verb&gt;
  &lt;/lexicon&gt;
&lt;/grammar&gt;
</code></pre>

<p>This grammar definition describes that the action <code>call</code> can be referenced with a verb phrase containing the verb <code>call</code>. It also contains a lexicon describing the grammar of <code>call</code> in English. We only need to specifiy the infinitive form for the verb; the other forms, such as imperative, are derived automatically.</p>
<p>Let's build and test.</p>
<pre><code class="bash">tdm build
tdm test eng
</code></pre>

<pre><code class="diff">On line 7 of basic_action/test/interaction_tests_eng.txt,
expected:
  S&gt; Who do you want to call?

but got:
  S&gt; The function is not implemented.
</code></pre>

<p>TDM replies! It means we did something right but apparently we need to implement the functionality as well. We need to add a plan for calling.</p>
<h1 id="step-5-plan">Step 5. Plan</h1>
<p>Plans group together what our users can talk about. The plan is executed in order to reach a goal, for example to perform an action. When talking about something in the plan, TDM infers which goal is being implied and puts it at the top of the agenda.</p>
<p>Let's check the boilerplate, in <code>basic_action/domain.xml</code>.</p>
<pre><code class="xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;
&lt;domain name=&quot;BasicActionDomain&quot; is_super_domain=&quot;true&quot;&gt;
  &lt;goal type=&quot;perform&quot; action=&quot;top&quot;&gt;
    &lt;plan&gt;
      &lt;forget_all/&gt;
      &lt;findout type=&quot;goal&quot;/&gt;
    &lt;/plan&gt;
  &lt;/goal&gt;
&lt;/domain&gt;
</code></pre>

<p>We get the top goal for free. This is the only goal on TDM's agenda at startup. It will make TDM ask us which goal we want to achieve. Remember the corresponding default interaction test.</p>
<pre><code class="diff">--- main menu
S&gt; What would you like to do?
</code></pre>

<p>Anyway, let's add a new goal and plan, corresponding to our <code>call</code> action. Extend the domain.</p>
<pre><code class="xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;
&lt;domain name=&quot;BasicActionDomain&quot; is_super_domain=&quot;true&quot;&gt;
  &lt;goal type=&quot;perform&quot; action=&quot;top&quot;&gt;
    &lt;plan&gt;
      &lt;forget_all/&gt;
      &lt;findout type=&quot;goal&quot;/&gt;
    &lt;/plan&gt;
  &lt;/goal&gt;
  &lt;goal type=&quot;perform&quot; action=&quot;call&quot;&gt;
    &lt;plan&gt;
      &lt;findout type=&quot;wh_question&quot; predicate=&quot;selected_contact&quot;/&gt;
      &lt;invoke_service_action name=&quot;Call&quot; postconfirm=&quot;true&quot;/&gt;
    &lt;/plan&gt;
  &lt;/goal&gt;
&lt;/domain&gt;
</code></pre>

<p>In <code>ontology.xml</code>, we also need to add the <code>selected_contact</code> predicate and its sort:</p>
<pre><code class="xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;
&lt;ontology name=&quot;BasicActionOntology&quot;&gt;
  &lt;action name=&quot;call&quot;/&gt;
  &lt;sort name=&quot;contact&quot; dynamic=&quot;true&quot;/&gt;
  &lt;predicate name=&quot;selected_contact&quot; sort=&quot;contact&quot;/&gt;
&lt;/ontology&gt;
</code></pre>

<p>A dynamic sort means its individuals are decided during run time, through the service interface.</p>
<p>Now build the DDD.</p>
<pre><code class="bash">tdm build
</code></pre>

<pre><code class="diff">Generating models for DDD 'basic_action'.
[eng] Cleaning build directory 'build/eng'...Done.
[eng] Generating grammar.

Missing grammar entry: How does the system ask about 'selected_contact'?

Example:

  &lt;question speaker=&quot;system&quot; predicate=&quot;selected_contact&quot; type=&quot;wh_question&quot;&gt;
    &lt;utterance&gt;what is selected contact&lt;/utterance&gt;
  &lt;/question&gt;


[eng] Finished generating grammar.
Finished generating models for DDD 'basic_action'.
Training models for DDD 'basic_action'.
[eng] Asserting that language grammar is lower case...Done.
[eng] Compiling generated grammar.
[eng] Finished compiling generated grammar.
[eng] No ASR specified, will not build language model.
[eng] Copying ASR language modules from '/private/tmp/ddd_root/basic_action/grammar/build/eng' to ddd directory...Done.
[eng] Not using word list correction, will not generate word list.
</code></pre>

<p>We got a new warning about a missing grammar entry. When referencing a predicate in a plan, we apparently need to specify its grammar entry. Since we're using a findout, the grammar entry is to define how TDM should speak the corresponding <code>question</code>. Let's extend <code>basic_action/grammar/grammar_eng.xml</code> with the following:</p>
<pre><code class="xml">  &lt;question speaker=&quot;system&quot; predicate=&quot;selected_contact&quot; type=&quot;wh_question&quot;&gt;
    &lt;utterance&gt;who do you want to call&lt;/utterance&gt;
  &lt;/question&gt;
</code></pre>

<p>Build and test.</p>
<pre><code class="bash">tdm build
tdm test eng
</code></pre>

<pre><code class="diff">Ran 2 tests in 0.363s

OK
</code></pre>

<p>Everything works as expected.</p>
<h1 id="step-6-service-interface">Step 6. Service interface</h1>
<p>In the next step, we want the user to be able to reply to the question about who to call. We thus extend <code>basic_action/test/interaction_tests_eng.txt</code> accordingly:</p>
<pre><code class="diff">--- call
S&gt; What would you like to do?
U&gt; call
S&gt; Who do you want to call?
U&gt; John
S&gt; Calling John.
</code></pre>

<p>Test:</p>
<pre><code class="bash">tdm test eng
</code></pre>

<pre><code class="diff">On line 9 of basic_action/test/interaction_tests_eng.txt,
expected:
  S&gt; Calling John.

but got:
  S&gt; I heard you say John. I don't understand. So, Who do you want to call?
</code></pre>

<p>As can be seen, the system doesn't understand John. We need to add an entity recognizer to our service interface. It needs to recognize entities of our <code>contact</code> sort. Our boilerplate service interface is basically empty, in <code>basic_action/service_interface.xml</code>, so let's just add it.</p>
<pre><code class="xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;
&lt;service_interface&gt;
    &lt;entity_recognizer name=&quot;BasicActionRecognizer&quot;&gt;
        &lt;target&gt;
            &lt;http endpoint=&quot;http://127.0.0.1:10102/contact_recognizer&quot;/&gt;
        &lt;/target&gt;
    &lt;/entity_recognizer&gt;
&lt;/service_interface&gt;
</code></pre>

<p>Here, we use an HTTP target with an end-point that runs an HTTP service. An HTTP service can be hosted anywhere where TDM can reach it. In this tutorial, we assume that the service is hosted locally, i.e. on the same machine as TDM (127.0.0.1), but this is not required. Generally, the developer can choose any web development framework as long as it is within the constraints of the <a href="APIs/http_service">HTTP service API protocol</a>.</p>
<p>The entity recognizer is responsible for finding all dynamic entities in utterances. Its accuracy affects the behaviour of the dialogue system. Since the search is conducted during runtime, particular care should be taken to ensure that the method is accurate, robust and has sufficient performance. See the <a href="APIs/http_service/#entity-recognizer-requests">API documentation</a> for details about request and response formats for entity recognizers.</p>
<p>In this case, we are providing you with a ready-to-use <a href="http_service_example.py">HTTP service</a>, which includes an entity recognizer. It uses <a href="http://flask.pocoo.org/docs/1.0/">Flask web framework</a> and <a href="http://jinja.pocoo.org/docs/2.10/">jinja2</a> templates in plain python.</p>
<p>As the service is hosted locally in this case, we recommend to save it in the DDD folder <code>basic_action</code>. Then, <strong>spawn</strong> it with Flask:</p>
<pre><code class="bash">export FLASK_APP=basic_action/http_service_example.py
flask run --port=10102
</code></pre>

<p>And then, build and test.</p>
<pre><code class="bash">tdm build
tdm test eng
</code></pre>

<pre><code class="diff">UnexpectedActionException: Expected one of the known actions [] but got 'Call'
</code></pre>

<p>Great, TDM appears to understand John. It wants to execute the <code>Call</code> action using our service interface, but could not find it. Let's add it to <code>basic_action/service_interface.xml</code>.</p>
<pre><code class="xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;
&lt;service_interface&gt;
    &lt;action name=&quot;Call&quot;&gt;
        &lt;parameters&gt;
            &lt;parameter predicate=&quot;selected_contact&quot; format=&quot;value&quot;/&gt;
        &lt;/parameters&gt;
        &lt;failure_reasons/&gt;
        &lt;target&gt;
            &lt;http endpoint=&quot;http://127.0.0.1:10102/call&quot;/&gt;
        &lt;/target&gt;
    &lt;/action&gt;
    &lt;entity_recognizer name=&quot;BasicActionRecognizer&quot;&gt;
        &lt;target&gt;
            &lt;http endpoint=&quot;http://127.0.0.1:10102/contact_recognizer&quot;/&gt;
        &lt;/target&gt;
    &lt;/entity_recognizer&gt;
&lt;/service_interface&gt;
</code></pre>

<p>To implement the 'call' action, see the <a href="APIs/http_service/#action-requests">API documentation</a> for details about request and response formats for actions. However, you can also find and use the 'call' action that has been already implemented in the example HTTP service.</p>
<p>Build again.</p>
<pre><code class="bash">tdm build
</code></pre>

<pre><code class="diff">Generating models for DDD 'basic_action'.
[eng] Cleaning build directory 'build/eng'...Done.
[eng] Generating grammar.

Missing grammar entry: How does the system report that the service action 'Call' ended? Example:

  &lt;report action=&quot;Call&quot; status=&quot;ended&quot;&gt;
    &lt;utterance&gt;performed Call&lt;/utterance&gt;
  &lt;/report&gt;


[eng] Finished generating grammar.
Finished generating models for DDD 'basic_action'.
Training models for DDD 'basic_action'.
[eng] Asserting that language grammar is lower case...Done.
[eng] Compiling generated grammar.
[eng] Finished compiling generated grammar.
[eng] No ASR specified, will not build language model.
[eng] Copying ASR language modules from '/private/tmp/ddd_root/basic_action/grammar/build/eng' to ddd directory...Done.
[eng] Not using word list correction, will not generate word list.
</code></pre>

<p>As can be seen, we need to add a grammar entry for the service action <code>Call</code>. This is required because we said so in the plan. Remember <code>postconfirm="true"</code> in the <code>invoke_service_action</code> entry of the plan?</p>
<p>Let's add a <code>report</code> grammar entry in <code>basic_action/grammar/grammar_eng.xml</code>. We can reference the <code>selected_contact</code> predicate since its part of the <code>findout</code> entries of the plan.</p>
<pre><code class="xml">  &lt;report action=&quot;Call&quot; status=&quot;ended&quot;&gt;
    &lt;utterance&gt;calling &lt;individual predicate=&quot;selected_contact&quot;/&gt;&lt;/utterance&gt;
  &lt;/report&gt;
</code></pre>

<p>Build and test.</p>
<pre><code class="bash">tdm build
tdm test eng
</code></pre>

<pre><code class="diff">Ran 2 tests in 0.363s

OK
</code></pre>

<p>Success!</p>
<h1 id="step-7-one-shot-utterances">Step 7. One-shot utterances</h1>
<p>The DDD so far handles very simple dialogues where the user enters one piece of information at a time. In order to support one-shot utterances such as "call John" containing several pieces of information (in this case an action and an answer regarding who to call), we need to extend the grammar. First we add a failing interaction test in <code>basic_action/test/interaction_tests_eng.txt</code>:</p>
<pre><code class="bash">--- one-shot utterance
U&gt; call John
S&gt; Calling John.
</code></pre>

<p>Run the tests to verify that the new one fails.</p>
<pre><code class="bash">tdm test eng
</code></pre>

<pre><code class="bash">On line 13 of basic_action/test/interaction_tests_eng.txt,
expected:
  S&gt; Calling John.

but got:
  S&gt; I heard you say call John. I don't understand. So, What would you like to do?
</code></pre>

<p>We now add the following lines to <code>basic_action/grammar/grammar_eng.xml</code>:</p>
<pre><code class="xml">  &lt;request action=&quot;call&quot;&gt;
    &lt;utterance&gt;call &lt;individual sort=&quot;contact&quot;/&gt;&lt;/utterance&gt;
  &lt;/request&gt;
</code></pre>

<p>The element <code>&lt;request&gt;</code> is used when defining things that the user can say to request that an action is to be performed. In contrast to <code>&lt;action&gt;</code>, <code>&lt;request&gt;</code> is user-specific and deals with whole utterances, including potential references to individuals. The element <code>&lt;individual&gt;</code> acts as a slot, showing that a certain place in the utterance refers to an individual.</p>
<p>Now build and test.</p>
<pre><code class="bash">tdm build
tdm test eng
</code></pre>

<pre><code class="bash">Ran 3 tests in 0.523s

OK
</code></pre>

<h1 id="step-8-adding-a-language">Step 8. Adding a language</h1>
<p>If you want to add support for a new language, the following steps are needed. First you need to modify the file <code>backend.config.json</code>. In the field <code>supported_languages</code>, add <code>"fre"</code> for French and/or <code>"dut"</code> for Dutch (separated by commas). Assuming we want to add support for French, the file contents are changed to</p>
<pre><code class="json">{
    &quot;supported_languages&quot;: [
        &quot;eng&quot;,
        &quot;fre&quot;
    ]
}
</code></pre>

<p>Second, we need to create interaction tests for the new language. For French, we add the file <code>basic_action/test/interaction_tests_fre.txt</code> with translated contents:</p>
<pre><code class="bash">--- main menu
S&gt; Que voulez-vous faire?

--- call
S&gt; Que voulez-vous faire?
U&gt; appellez
S&gt; Qui voulez-vous appeler?
U&gt; André
S&gt; J'appelle André.

--- one-shot utterance
U&gt; appellez André
S&gt; J'appelle André.
</code></pre>

<p>Make sure to save the interaction tests with UTF-8 encoding without byte-order mark (BOM) when using non-ASCII characters.</p>
<p>Check our HTTP service to see that name of the contacts are already there translated in French (and even Dutch):</p>
<pre><code class="python">CONTACTS_FRENCH = {
    &quot;Jean&quot;: JOHN,
    u&quot;Élise&quot;: LISA,
    &quot;Marie&quot;: MARY,
    u&quot;André&quot;: ANDY,
}

CONTACTS_DUTCH = {
    &quot;Jan&quot;: JOHN,
    &quot;Lisa&quot;: LISA,
    &quot;Maria&quot;: MARY,
    &quot;Andreas&quot;: ANDY,
}
</code></pre>

<p>Finally, we need to create a grammar file for the new language. For French, we add the file <code>basic_action/grammar/grammar_fre.xml</code> with the following contents:</p>
<pre><code class="xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;
&lt;grammar&gt;
  &lt;action name=&quot;call&quot;&gt;
    &lt;verb-phrase&gt;
      &lt;verb ref=&quot;call&quot;/&gt;
    &lt;/verb-phrase&gt;
  &lt;/action&gt;

  &lt;request action=&quot;call&quot;&gt;
    &lt;utterance&gt;appellez &lt;individual sort=&quot;contact&quot;/&gt;&lt;/utterance&gt;
  &lt;/request&gt;

  &lt;lexicon&gt;
    &lt;verb id=&quot;call&quot;&gt;
      &lt;infinitive&gt;appeller&lt;/infinitive&gt;
    &lt;/verb&gt;
  &lt;/lexicon&gt;

  &lt;question speaker=&quot;system&quot; predicate=&quot;selected_contact&quot; type=&quot;wh_question&quot;&gt;
    &lt;utterance&gt;qui voulez-vous appeler&lt;/utterance&gt;
  &lt;/question&gt;

  &lt;report action=&quot;Call&quot; status=&quot;ended&quot;&gt;
    &lt;utterance&gt;j'appelle &lt;individual predicate=&quot;selected_contact&quot;/&gt;&lt;/utterance&gt;
  &lt;/report&gt;
&lt;/grammar&gt;
</code></pre>

<p>Build and test. Note the changed language parameter for interaction testing.</p>
<pre><code class="bash">tdm build
tdm test fre
</code></pre>

<pre><code class="bash">Ran 3 tests in 0.509s

OK
</code></pre>

<h1 id="step-9-how-to-continue">Step 9. How to continue</h1>
<p>This tutorial has illustrated how to implement the <a href="examples#basic-action">basic action example</a>. The source code is available on <a href="https://github.com/Talkamatic/dialogue-domain-descriptions/tree/master/basic_action">Github</a>.</p>
<p>In order to continue, go to the <a href="examples">examples</a> section to find an example similar to your desired functionality. Steal the best ideas from there, adjusting them for yor domain. Remember to work test driven, adding a test first, then making it work.</p>
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid" aria-label="Footer">
        
          <a href="formalism.html" title="Dialog Formalism" class="md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
            </div>
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Dialog Formalism
              </div>
            </div>
          </a>
        
        
          <a href="examples.html" title="Examples" class="md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Examples
              </div>
            </div>
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="assets/javascripts/vendor.d710d30a.min.js"></script>
      <script src="assets/javascripts/bundle.5f27aba8.min.js"></script><script id="__lang" type="application/json">{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents"}</script>
      
      <script>
        app = initialize({
          base: ".",
          features: [],
          search: Object.assign({
            worker: "assets/javascripts/worker/search.27c6a5e6.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script>
      
    
  </body>
</html>